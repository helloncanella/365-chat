(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{103:function(e,t,n){},116:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(53),o=n.n(c),i=(n(73),n(16)),s=n(17),u=n(19),l=n(18),m=n(20),d=n(121),p=n(57),f=n(118),g=n(25),v=n.n(g),h=n(32),b=n(22),E=n(6),j=(n(77),function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).onSubmit=function(e){e.preventDefault(),n.input.value&&n.props.registerUser({name:n.input.value})},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"registration"},r.a.createElement("div",{className:"registration-card"},r.a.createElement("div",{className:"logo"},"365"),r.a.createElement("div",{className:"content"},r.a.createElement("h2",null,"Your name"),r.a.createElement("form",{onSubmit:this.onSubmit},r.a.createElement("input",{type:"text",ref:function(t){return e.input=t}}),r.a.createElement("button",{type:"submit",disabled:this.props.isRegistering},this.props.isRegistering?"loading...":"register")))))}}]),t}(a.Component)),O=n(122),y=n(21),N=n(23),w=n.n(N),k=n(27),I=n.n(k);function S(){var e=Object(b.a)(["\n  mutation CreateUser($name: String!, $color: String!) {\n    createUser(name: $name, color: $color) {\n      _id\n    }\n  }\n"]);return S=function(){return e},e}var x=w()(S()),M=function(){var e=["purple","blue","red","orange","green","indigo"];return e[I.a.random(0,e.length-1)]},C=Object(E.a)(O.a,Object(E.f)("isRegistering","setLoadingState",!1),Object(y.b)(x,{props:function(e){var t=e.mutate;return{createUser:function(){var e=Object(h.a)(v.a.mark(function e(){var n,a,r,c=arguments;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=c.length>0&&void 0!==c[0]?c[0]:{},a=n.name,e.next=3,t({variables:{name:a,color:M()}});case 3:return r=e.sent,e.abrupt("return",I.a.get(r,"data.createUser"));case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}}}),Object(E.d)({registerUser:function(e){return function(){var t=Object(h.a)(v.a.mark(function t(n){var a,r;return v.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=n.name){t.next=3;break}return t.abrupt("return");case 3:return e.setLoadingState(!0),t.next=6,e.createUser({name:a});case 6:r=t.sent,localStorage.setItem("loggedUserId",r._id),e.setLoadingState(!1),e.history.push("/");case 10:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()}}))(j);n(85);function U(e){var t=e.icon,n=e.className,a=e.style;return r.a.createElement("div",{className:"fa fa-".concat(t," ").concat(n||""),style:a||{}})}var _=n(45),D=(n(86),n(120));function $(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.icon,a=void 0===n?null:n,c=e.rightComponent,o=void 0===c?null:c,i=e.className,s=e.path,u=e.style;return r.a.createElement(D.a,{className:"menu-item ".concat(i||""),activeClassName:"selected",style:Object(_.a)({},u||{}),to:s},r.a.createElement("div",{className:"content"},a&&r.a.createElement("div",{className:"icon-container"},a),r.a.createElement("div",{className:"name"},t)),o)}n(87);var q=n(58),R=[{name:"Simple room",color:"orange",id:"single-room",isOnline:!0}];Object(E.a)(O.a,Object(E.e)(function(e){var t,n=e.match;if(n)return{receivers:[(t=n.params.id,R.find(function(e){return e.id===t}))]}})),n(103);var z=Object(E.a)(E.c)(function(){var e=(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).receiver||{};return e.name,e.isOnline,r.a.createElement("div",{className:"header"},r.a.createElement("h3",{className:"user-name"},"Simple room"))}),T=Object(E.a)(Object(E.e)(function(e){return{receiver:R.find(function(t){return t.id===e.roomId})}}))(z),Y=n(64),L=n(59),P=n.n(L);var A=Object(E.a)(E.c)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.name,n=e.avatar,a=e.text,c=e.date;return r.a.createElement("div",{className:"message"},n&&r.a.createElement("div",{className:"avatar-column"},n),r.a.createElement("div",{className:"message-column"},r.a.createElement("div",{className:"meta-header"},r.a.createElement("span",{className:"name"},t)," ",r.a.createElement("span",{className:"date"},P()(c).format("DD/MM/YYYY"))),r.a.createElement("div",{className:"message-body"},a.split("\n").map(function(e,t){return r.a.createElement("p",{key:"message-timestamp-".concat(new Date(c).getTime(),"-").concat(t)},e)}))))});var B=Object(E.a)(E.c)(function(e){return r.a.createElement("ul",{className:"all-messages messages"},(e.messages||[]).map(function(e,t){return r.a.createElement("li",{className:"message-container",key:"message-".concat(t)},r.a.createElement(A,e))}))});function F(){var e=Object(b.a)(["\n  subscription NewMessage {\n    newMessage {\n      _id\n      content\n      timestamp\n      author {\n        _id\n        name\n        color\n      }\n    }\n  }\n"]);return F=function(){return e},e}function J(){var e=Object(b.a)(["\n  query AllMessages {\n    messages {\n      _id\n      content\n      author {\n        _id\n        name\n        color\n      }\n      timestamp\n    }\n  }\n"]);return J=function(){return e},e}var Q=w()(J()),W=w()(F()),G=Object(E.a)(Object(y.b)(Q),Object(E.b)(function(e){var t=e.data||{},n=t.loading,a=t.messages;return{messages:(void 0===a?[]:a).map(K).sort(H),loading:n}}),Object(y.b)(W,{name:"subscription"}),Object(E.e)(function(e){var t=e.subscription,n=(e.loading,e.messages),a=(t||{}).newMessage;return{messages:a?[].concat(Object(Y.a)(n),[K(a)]).sort(H):n}}))(B),H=function(e,t){return new Date(e.date).getTime()-new Date(t.date).getTime()};function K(e){var t=function(t){return I.a.get(e,t)};return{name:t("author.name"),date:new Date(t("timestamp")),text:t("content"),avatar:r.a.createElement("div",{style:{display:"flex",borderRadius:"50%",width:50,height:50,alignItems:"center",justifyContent:"center",background:t("author.color")}})}}var V=function(e){function t(){var e,n;Object(i.a)(this,t);for(var a=arguments.length,r=new Array(a),c=0;c<a;c++)r[c]=arguments[c];return(n=Object(u.a)(this,(e=Object(l.a)(t)).call.apply(e,[this].concat(r)))).onSubmit=function(e){e.preventDefault(),n.input.value&&(n.props.sendMessage(n.input.value),n.input.value="")},n}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){var e=this;return r.a.createElement("div",{className:"footer"},r.a.createElement("form",{className:"input-container",onSubmit:this.onSubmit},r.a.createElement("input",{type:"text",placeholder:"Message",ref:function(t){return e.input=t}})))}}]),t}(r.a.Component);function X(){var e=Object(b.a)(["\n  mutation SendMessage(\n    $userId: String!\n    $content: String!\n    $timestamp: Float!\n  ) {\n    sendMessage(userId: $userId, content: $content, timestamp: $timestamp) {\n      _id\n      content\n      timestamp\n      author {\n        _id\n        name\n      }\n    }\n  }\n"]);return X=function(){return e},e}function Z(){var e=Object(b.a)(["\n  query LoggedUser {\n    loggedUser {\n      _id\n      name\n    }\n  }\n"]);return Z=function(){return e},e}var ee=w()(Z()),te=w()(X()),ne=Object(E.a)(Object(y.b)(ee,{props:function(e){var t=e.data;return{loggedUser:(void 0===t?{}:t).loggedUser}}}),Object(y.b)(te,{props:function(e){var t=e.mutate,n=e.ownProps,a=(n=void 0===n?{}:n).loggedUser,r=void 0===a?{}:a;return{sendMessage:function(){var e=Object(h.a)(v.a.mark(function e(n){var a;return v.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return",null);case 2:a=(new Date).getTime(),t({variables:{userId:r._id,content:n,timestamp:a},optimisticResponse:{sendMessage:{_id:-1*Math.random(),__typename:"Message",content:n,author:r,timestamp:a}}});case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}()}},options:{update:function(e,t){var n=t.data.sendMessage,a=Q,r=e.readQuery({query:a});console.log(r.messages),r.messages.push(n),e.writeQuery({query:a,data:r})}}}))(V),ae=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"chat"},r.a.createElement(T,{roomId:this.roomId}),this.body,r.a.createElement(ne,{roomId:this.roomId}))}},{key:"body",get:function(){return r.a.createElement(q.Scrollbars,{className:"body"},r.a.createElement("div",{className:"body-content"},r.a.createElement(G,{roomId:this.roomId})))}},{key:"roomId",get:function(){return I.a.get(this.props,"match.params.roomId")}}]),t}(a.Component);function re(e){var t=e.children;return r.a.createElement("div",{className:"screen-centered",style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"}},t)}var ce=[{path:"/chat-list",exact:!0,icon:"comment",name:"Chat",render:function(){return r.a.createElement(re,null,r.a.createElement("h1",{style:{color:"gray",fontSize:"5rem"}},"Chat list"))}},{path:"/partner",icon:"users",name:"Partner",render:function(){return r.a.createElement(re,null,r.a.createElement("h1",{style:{color:"gray",fontSize:"5rem"}},"Partner"))}},{path:"/document",icon:"file-text",name:"Document",render:function(){return r.a.createElement(re,null,r.a.createElement("h1",{style:{color:"gray",fontSize:"5rem"}},"Document"))}},{from:"/",redirect:"/chat-list",exact:!0}],oe=n(44),ie=Object(E.a)(Object(E.e)(function(e){return{contacts:R}}));function se(){return r.a.createElement(re,null,r.a.createElement("h1",{style:{color:"gray",fontSize:"5rem"}},"404"))}var ue=Object(E.a)(O.a,ie)(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.contacts,n=void 0===t?[]:t,a=e.match;return r.a.createElement("main",null,r.a.createElement(d.a,null,ce.map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.component,n=e.render,c=e.path,o=e.redirect,i=e.exact,s=e.from,u=arguments.length>1?arguments[1]:void 0,l={exact:i,key:"section-route-".concat(u)};return o?r.a.createElement(f.a,Object.assign({},l,{from:s,to:o})):c?r.a.createElement(p.a,Object.assign({},l,{render:n,component:t,path:Object(oe.join)(a.url,c),key:"section-menu-item-".concat(u)})):null}),r.a.createElement(p.a,{path:"/chat/:roomId(".concat(n.map(function(e){return e.id}).join("|"),")"),component:ae}),r.a.createElement(p.a,{component:se})))}),le=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"home"},r.a.createElement("div",{className:"first-menu"},r.a.createElement("img",{src:"/images/365-logo.png",alt:"logo"})),r.a.createElement("div",{className:"wrap"},r.a.createElement("div",{className:"notifications"}),this.secondMenu,r.a.createElement(ue,null)))}},{key:"sectionsMenu",get:function(){return r.a.createElement("ul",{className:"sections-menu"},ce.filter(function(e){return!e.redirect}).map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.path,n=e.icon,a=e.name,c=arguments.length>1?arguments[1]:void 0;return r.a.createElement("li",{key:"section-menu-item-".concat(c)},r.a.createElement($,{path:t,name:a,selected:!1,icon:r.a.createElement(U,{className:"icon",icon:n})}))}))}},{key:"favoriteContacts",get:function(){return r.a.createElement("div",{className:"favorite-contacts"},r.a.createElement("h5",{className:"title"},"Favorite Contacts"),r.a.createElement("ul",{className:"contacts"},R.map(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(e.link,e.icon,e.name),n=e.color,a=e.id,c=(e.isOnline,arguments.length>1?arguments[1]:void 0);return r.a.createElement("li",{key:"contact-".concat(c)},r.a.createElement($,{name:t,path:Object(oe.join)("/chat",a),icon:r.a.createElement("div",{style:{width:30,height:30,background:n,borderRadius:"50%",display:"flex",justifyContent:"center",alignItems:"center"}})}))})))}},{key:"secondMenu",get:function(){return r.a.createElement("div",{className:"second-menu"},this.sectionsMenu,this.favoriteContacts)}}]),t}(a.Component),me=function(e){function t(){return Object(i.a)(this,t),Object(u.a)(this,Object(l.a)(t).apply(this,arguments))}return Object(m.a)(t,e),Object(s.a)(t,[{key:"render",value:function(){return r.a.createElement("div",{className:"app"},r.a.createElement(d.a,null,r.a.createElement(p.a,{component:C,path:"/registration",exact:!0}),r.a.createElement(p.a,{path:"/",render:function(){return localStorage.getItem("loggedUserId")?r.a.createElement(le,null):r.a.createElement(f.a,{to:"/registration"})}})))}}]),t}(a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var de=n(119),pe=n(29),fe=n(66),ge=n(8),ve=n(65),he=n(60),be=n(3),Ee=n(63),je="chat-365.herokuapp.com",Oe=function(){return localStorage.getItem("loggedUserId")||""},ye=new he.a({uri:"ws://".concat(je,"/graphql"),options:{reconnect:!0,connectionParams:function(){return{authToken:Oe()}}}}),Ne=Object(Ee.a)(function(e,t){var n=t.headers;return{headers:Object(_.a)({},n,{authorization:Oe()})}}),we=new ve.a({uri:"http://".concat(je,"/graphql")}),ke=Object(ge.d)(function(e){var t=e.query,n=Object(be.k)(t),a=n.kind,r=n.operation;return"OperationDefinition"===a&&"subscription"===r},ye,Ne.concat(we));o.a.render(r.a.createElement(y.a,{client:new pe.a({link:ke,cache:new fe.a})},r.a.createElement(de.a,null,r.a.createElement(p.a,{component:me}))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},68:function(e,t,n){e.exports=n(116)},73:function(e,t,n){},77:function(e,t,n){},85:function(e,t,n){},86:function(e,t,n){},87:function(e,t,n){}},[[68,1,2]]]);
//# sourceMappingURL=main.0c79c55c.chunk.js.map